{"version":3,"file":"create.js","sources":["pages/create/create.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY3JlYXRlL2NyZWF0ZS52dWU"],"sourcesContent":["<template>\n  <GlobalLayout title=\"创建\">\n    \n<view class=\"container\">\n    <picker mode=\"selector\" :range=\"categories\" range-key=\"name\" @change=\"onCategoryChange\">\n      <view class=\"picker-item\">\n        <text>发布到：</text>\n        <text class=\"selected-category\">{{ selectedCategory ? selectedCategory.name : '点击选择板块 >' }}</text>\n      </view>\n    </picker>\n\n    <input \n      class=\"input-title\" \n      placeholder=\"起个吸引人的标题...\" \n      v-model=\"formData.title\"\n    />\n\n    <textarea \n      class=\"input-content\" \n      placeholder=\"分享你的新鲜事...\" \n      v-model=\"formData.content\"\n      maxlength=\"-1\"\n    ></textarea>\n\n    <view class=\"image-upload-area\">\n      <view \n        class=\"image-preview\" \n        v-for=\"(img, index) in formData.images\" \n        :key=\"index\"\n      >\n        <image :src=\"img\" mode=\"aspectFill\" />\n        <view class=\"delete-btn\" @click=\"removeImage(index)\">×</view>\n      </view>\n      \n      <view class=\"upload-btn\" @click=\"chooseImage\" v-if=\"formData.images.length < 9\">\n        <text>+</text>\n      </view>\n    </view>\n\n    <button class=\"submit-btn\" @click=\"submitPost\">发布</button>\n  </view>\n  </GlobalLayout>\n</template>\n\n<script setup>\nimport { useTabDrawerCloser } from '@/composables/useTabDrawerCloser.js'\r\nimport { ref, computed } from 'vue';\nimport { usePostStore } from '@/stores/usePostStore';\r\nuseTabDrawerCloser()\r\nconst postStore = usePostStore();\nconst categories = computed(() => postStore.categories);\n\nconst selectedCategory = ref(null);\nconst formData = ref({\n  title: '',\n  content: '',\n  images: []\n});\n\n// 选择分类\nconst onCategoryChange = (e) => {\n  const index = e.detail.value;\n  selectedCategory.value = categories.value[index];\n};\n\n// 选择图片\nconst chooseImage = () => {\n  uni.chooseImage({\n    count: 9 - formData.value.images.length,\n    success: (res) => {\n      // 临时路径，实际开发中这里需要调用 uni.uploadFile 上传到服务器\n      formData.value.images = [...formData.value.images, ...res.tempFilePaths];\n    }\n  });\n};\n\n// 删除图片\nconst removeImage = (index) => {\n  formData.value.images.splice(index, 1);\n};\n\n// 提交发布\nconst submitPost = () => {\n  if (!selectedCategory.value) return uni.showToast({ title: '请选择版块', icon: 'none' });\n  if (!formData.value.title) return uni.showToast({ title: '请输入标题', icon: 'none' });\n  if (!formData.value.content) return uni.showToast({ title: '请输入内容', icon: 'none' });\n\n  // 调用 Store 的 Action\n  postStore.addPost({\n    title: formData.value.title,\n    content: formData.value.content,\n    images: formData.value.images,\n    categoryId: selectedCategory.value.id,\n    categoryName: selectedCategory.value.name\n  });\n\n  uni.showToast({ title: '发布成功' });\n  \n  // 重置表单\n  formData.value = { title: '', content: '', images: [] };\n  selectedCategory.value = null;\n\n  // 跳转回主页或社区页\n  setTimeout(() => {\n    uni.switchTab({ url: '/pages/index/index' }); // 假设这是你的主页路径\n  }, 1000);\n};\r\n\n</script>\n\n<style lang=\"scss\" scoped>\n\n.container { padding: 30rpx; background-color: #fff; min-height: 100vh; }\n.picker-item { \n  padding: 20rpx 0; \n  border-bottom: 1px solid #eee; \n  font-size: 30rpx; \n  color: #333;\n  display: flex;\n  justify-content: space-between;\n}\n.selected-category { color: #007aff; font-weight: bold; }\n.input-title {\n  font-size: 36rpx;\n  font-weight: bold;\n  margin: 30rpx 0;\n  padding: 10rpx 0;\n  border-bottom: 1px solid #f5f5f5;\n}\n.input-content {\n  width: 100%;\n  height: 300rpx;\n  font-size: 30rpx;\n  line-height: 1.6;\n}\n.image-upload-area {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 20rpx;\n  margin-top: 30rpx;\n}\n.upload-btn, .image-preview {\n  width: 200rpx;\n  height: 200rpx;\n  border-radius: 8rpx;\n  position: relative;\n}\n.upload-btn {\n  background-color: #f8f8f8;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 60rpx;\n  color: #ccc;\n}\n.image-preview image { width: 100%; height: 100%; border-radius: 8rpx; }\n.delete-btn {\n  position: absolute; top: -10rpx; right: -10rpx;\n  background: red; color: white; width: 36rpx; height: 36rpx;\n  border-radius: 50%; text-align: center; line-height: 32rpx;\n}\n.submit-btn {\n  margin-top: 50rpx;\n  background-color: #007aff;\n  color: white;\n  border-radius: 50rpx;\n}\n</style>","import MiniProgramPage from 'C:/Users/ffx/OneDrive/Desktop/项目源码/xuedong-uniapp/pages/create/create.vue'\nwx.createPage(MiniProgramPage)"],"names":["useTabDrawerCloser","usePostStore","computed","ref","uni"],"mappings":";;;;;;;;;;;;;;;AAgDAA,mCAAAA,mBAAoB;AACpB,UAAM,YAAYC,oBAAY,aAAA;AAC9B,UAAM,aAAaC,cAAQ,SAAC,MAAM,UAAU,UAAU;AAEtD,UAAM,mBAAmBC,cAAAA,IAAI,IAAI;AACjC,UAAM,WAAWA,cAAAA,IAAI;AAAA,MACnB,OAAO;AAAA,MACP,SAAS;AAAA,MACT,QAAQ,CAAE;AAAA,IACZ,CAAC;AAGD,UAAM,mBAAmB,CAAC,MAAM;AAC9B,YAAM,QAAQ,EAAE,OAAO;AACvB,uBAAiB,QAAQ,WAAW,MAAM,KAAK;AAAA,IACjD;AAGA,UAAM,cAAc,MAAM;AACxBC,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO,IAAI,SAAS,MAAM,OAAO;AAAA,QACjC,SAAS,CAAC,QAAQ;AAEhB,mBAAS,MAAM,SAAS,CAAC,GAAG,SAAS,MAAM,QAAQ,GAAG,IAAI,aAAa;AAAA,QACxE;AAAA,MACL,CAAG;AAAA,IACH;AAGA,UAAM,cAAc,CAAC,UAAU;AAC7B,eAAS,MAAM,OAAO,OAAO,OAAO,CAAC;AAAA,IACvC;AAGA,UAAM,aAAa,MAAM;AACvB,UAAI,CAAC,iBAAiB;AAAO,eAAOA,oBAAI,UAAU,EAAE,OAAO,SAAS,MAAM,OAAQ,CAAA;AAClF,UAAI,CAAC,SAAS,MAAM;AAAO,eAAOA,cAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,OAAQ,CAAA;AAChF,UAAI,CAAC,SAAS,MAAM;AAAS,eAAOA,cAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,OAAQ,CAAA;AAGlF,gBAAU,QAAQ;AAAA,QAChB,OAAO,SAAS,MAAM;AAAA,QACtB,SAAS,SAAS,MAAM;AAAA,QACxB,QAAQ,SAAS,MAAM;AAAA,QACvB,YAAY,iBAAiB,MAAM;AAAA,QACnC,cAAc,iBAAiB,MAAM;AAAA,MACzC,CAAG;AAEDA,oBAAAA,MAAI,UAAU,EAAE,OAAO,OAAQ,CAAA;AAG/B,eAAS,QAAQ,EAAE,OAAO,IAAI,SAAS,IAAI,QAAQ,CAAA;AACnD,uBAAiB,QAAQ;AAGzB,iBAAW,MAAM;AACfA,sBAAAA,MAAI,UAAU,EAAE,KAAK,qBAAsB,CAAA;AAAA,MAC5C,GAAE,GAAI;AAAA,IACT;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzGA,GAAG,WAAW,eAAe;"}