{"version":3,"file":"useUserStore.js","sources":["stores/useUserStore.js"],"sourcesContent":["// stores/useUserStore.js\nimport { defineStore } from 'pinia';\n\nexport const useUserStore = defineStore('user', {\n  state: () => ({\n    // --- 1. 用户详细信息 ---\n    userInfo: {\n      username: '点击登录',\n      avatar: '', \n      gender: 0, // 0:保密, 1:男, 2:女\n      phone: '',\n      age: '',\n      karma: 1,\n      appAgeDays: 1\n    },\n    isLoggedIn: false,\n\n    // --- 2. 打卡数据 ---\n    totalDays: 0,\n    lastCheckInDate: '' \n  }),\n\n  getters: {\n    // 判断今天是否已打过卡\n    isCheckedInToday: (state) => {\n      const today = new Date().toLocaleDateString();\n      return state.lastCheckInDate === today;\n    }\n  },\n\n  actions: {\n    // --- 核心：初始化所有数据 ---\n    hydrate() {\n      // 1. 读取打卡数据\n      const checkinData = uni.getStorageSync('user_checkin_data');\n      if (checkinData) {\n        this.totalDays = checkinData.totalDays || 0;\n        this.lastCheckInDate = checkinData.lastCheckInDate || '';\n      }\n\n      // 2. 读取用户信息\n      const userData = uni.getStorageSync('user_info_data');\n      if (userData) {\n        this.userInfo = userData;\n        this.isLoggedIn = true;\n      }\n    },\n\n    // --- 功能 A: 打卡逻辑 (之前丢失的部分) ---\n    checkIn() {\n      const today = new Date().toLocaleDateString();\n\n      // 如果今天已经打过了，返回 false\n      if (this.lastCheckInDate === today) {\n        return false;\n      }\n\n      // 执行打卡\n      this.totalDays++;\n      this.lastCheckInDate = today;\n\n      // 保存打卡数据\n      this.saveCheckInToStorage();\n      return true;\n    },\n\n    // 专门保存打卡数据\n    saveCheckInToStorage() {\n      uni.setStorageSync('user_checkin_data', {\n        totalDays: this.totalDays,\n        lastCheckInDate: this.lastCheckInDate\n      });\n    },\n\n    // --- 功能 B: 用户登录与资料逻辑 ---\n    updateUserInfo(info) {\n      this.userInfo = { ...this.userInfo, ...info };\n      this.isLoggedIn = true;\n      this.saveUserToStorage();\n    },\n\n    logout() {\n      this.userInfo = {\n        username: '点击登录',\n        avatar: '',\n        gender: 0,\n        phone: '',\n        age: '',\n        karma: 1,\n        appAgeDays: 1\n      };\n      this.isLoggedIn = false;\n      // 清除用户信息缓存\n      uni.removeStorageSync('user_info_data');\n      \n      // (可选) 如果你想退出登录同时也清除打卡记录，取消下面这行的注释\n      // uni.removeStorageSync('user_checkin_data'); \n      // this.totalDays = 0;\n    },\n\n    // 专门保存用户数据\n    saveUserToStorage() {\n      uni.setStorageSync('user_info_data', this.userInfo);\n    }\n  }\n});"],"names":["defineStore","uni"],"mappings":";;AAGY,MAAC,eAAeA,cAAW,YAAC,QAAQ;AAAA,EAC9C,OAAO,OAAO;AAAA;AAAA,IAEZ,UAAU;AAAA,MACR,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,QAAQ;AAAA;AAAA,MACR,OAAO;AAAA,MACP,KAAK;AAAA,MACL,OAAO;AAAA,MACP,YAAY;AAAA,IACb;AAAA,IACD,YAAY;AAAA;AAAA,IAGZ,WAAW;AAAA,IACX,iBAAiB;AAAA,EACrB;AAAA,EAEE,SAAS;AAAA;AAAA,IAEP,kBAAkB,CAAC,UAAU;AAC3B,YAAM,SAAQ,oBAAI,KAAM,GAAC,mBAAkB;AAC3C,aAAO,MAAM,oBAAoB;AAAA,IAClC;AAAA,EACF;AAAA,EAED,SAAS;AAAA;AAAA,IAEP,UAAU;AAER,YAAM,cAAcC,cAAAA,MAAI,eAAe,mBAAmB;AAC1D,UAAI,aAAa;AACf,aAAK,YAAY,YAAY,aAAa;AAC1C,aAAK,kBAAkB,YAAY,mBAAmB;AAAA,MACvD;AAGD,YAAM,WAAWA,cAAAA,MAAI,eAAe,gBAAgB;AACpD,UAAI,UAAU;AACZ,aAAK,WAAW;AAChB,aAAK,aAAa;AAAA,MACnB;AAAA,IACF;AAAA;AAAA,IAGD,UAAU;AACR,YAAM,SAAQ,oBAAI,KAAM,GAAC,mBAAkB;AAG3C,UAAI,KAAK,oBAAoB,OAAO;AAClC,eAAO;AAAA,MACR;AAGD,WAAK;AACL,WAAK,kBAAkB;AAGvB,WAAK,qBAAoB;AACzB,aAAO;AAAA,IACR;AAAA;AAAA,IAGD,uBAAuB;AACrBA,oBAAG,MAAC,eAAe,qBAAqB;AAAA,QACtC,WAAW,KAAK;AAAA,QAChB,iBAAiB,KAAK;AAAA,MAC9B,CAAO;AAAA,IACF;AAAA;AAAA,IAGD,eAAe,MAAM;AACnB,WAAK,WAAW,EAAE,GAAG,KAAK,UAAU,GAAG;AACvC,WAAK,aAAa;AAClB,WAAK,kBAAiB;AAAA,IACvB;AAAA,IAED,SAAS;AACP,WAAK,WAAW;AAAA,QACd,UAAU;AAAA,QACV,QAAQ;AAAA,QACR,QAAQ;AAAA,QACR,OAAO;AAAA,QACP,KAAK;AAAA,QACL,OAAO;AAAA,QACP,YAAY;AAAA,MACpB;AACM,WAAK,aAAa;AAElBA,0BAAI,kBAAkB,gBAAgB;AAAA,IAKvC;AAAA;AAAA,IAGD,oBAAoB;AAClBA,oBAAAA,MAAI,eAAe,kBAAkB,KAAK,QAAQ;AAAA,IACnD;AAAA,EACF;AACH,CAAC;;"}